<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="../css/membership.css" />
    <script defer src="../js/membership.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- modal -->
    <link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-material-ui/material-ui.css" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>


    <script>
        /* !!!ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬ */
        function idCheck() {
            let form = document.getElementById('id');

            axios({
                method: 'post',
                url: 'http://localhost:8000/user/id_check',
                data: {
                    user_id: form.id.value,
                }
            }).then((rep) => {
                return rep.data;
            }).then((data) => {
                console.log(data);
                // dataëŠ” UserControllerì—ì„œ true, false í˜•ì‹ìœ¼ë¡œ ë³´ë‚¸ë‹¤.
                if (data) { // dataê°€ trueì´ë©´ ì‹¤í–‰
                    /* ì°¸ê³ ìš© */
                    // $("#checkID_text").css("color", "green"); // idê°€ checkID_text ì¸ íƒœê·¸ css ì„¤ì •
                    // $("#checkID_text").css("font-size", "0.8rem");
                    // $("#checkID_text").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤."); // idê°€ checkID_text ì¸ íƒœê·¸ í…ìŠ¤íŠ¸ ë³€ê²½
                    // $("#btnJoin").removeAttr("disabled") // ê°€ì…í•˜ê¸° ë²„íŠ¼ì˜ disabled ì†ì„±ì„ ì œê±°, disabled: í´ë¦­í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ì†ì„±

                    alert('ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
                    $("#btnJoin").removeAttr("disabled") // ê°€ì…í•˜ê¸° ë²„íŠ¼ì˜ disabled ì†ì„± ì œê±°
                } else { // dataê°€ falseì´ë©´ ì‹¤í–‰
                    /* ì°¸ê³ ìš© */
                    // $("#checkID_text").css("color", "red");
                    // $("#checkID_text").css("font-size", "0.8rem");
                    // $("#checkID_text").text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
                    // $("#btnJoin").attr("disabled", "true");

                    alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
                    $("#btnJoin").attr("disabled", "true"); // ê°€ì…í•˜ê¸° ë²„íŠ¼ì— disabled ì†ì„± ì¶”ê°€
                }
            });
        }

        /* !!!ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ */
        function nickCheck() {
            let form = document.getElementById('nick');

            axios({
                method: 'post',
                url: 'http://localhost:8000/user/nick_check',
                data: {
                    nickName: form.nick.value,
                }
            }).then((rep) => {
                return rep.data;
            }).then((data) => {
                console.log(data);
                // dataëŠ” UserControllerì—ì„œ true, false í˜•ì‹ìœ¼ë¡œ ë³´ë‚¸ë‹¤.
                if (data) { // dataê°€ trueì´ë©´ ì‹¤í–‰
                    /* ì°¸ê³ ìš© */
                    // $("#checkNickname_text").css("color", "green");
                    // $("#checkNickname_text").css("font-size", "0.8rem");
                    // $("#checkNickname_text").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
                    // $("#btnJoin").removeAttr("disabled")

                    alert('ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.');
                    $("#btnJoin").removeAttr("disabled") // ê°€ì…í•˜ê¸° ë²„íŠ¼ì˜ disabled ì†ì„± ì œê±°
                } else { // dataê°€ falseì´ë©´ ì‹¤í–‰
                    /* ì°¸ê³ ìš© */
                    // $("#checkNickname_text").css("color", "red");
                    // $("#checkNickname_text").css("font-size", "0.8rem");
                    // $("#checkNickname_text").text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
                    // $("#btnJoin").attr("disabled", "true");

                    alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.');
                    $("#btnJoin").attr("disabled", "true") // ê°€ì…í•˜ê¸° ë²„íŠ¼ì— disabled ì†ì„± ì¶”ê°€
                }
            });
        }

        /* !!!ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */
        function pwCheck() {
            if (document.getElementById('pswd1').value != '' && document.getElementById('pswd2').value != '') {

                if (document.getElementById('pswd1').value == document.getElementById('pswd2').value) {
                    /* ì°¸ê³ ìš© */
                    // document.getElementById('check').innerHTML = 'ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ğŸ¥°'
                    // document.getElementById('check').style.color = 'rgb(54, 54, 255)';
                    // $("#check").css("font-size", "0.8rem");

                    /* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë¡œì§ - ì²´í¬ ë¶€íƒë“œë ¤ìš”! ì¼ë‹¨ ì„ì˜ë¡œ ë§Œë“¤ì–´ë†¨ìŠµë‹ˆë‹¤. */
                    alert('ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                    // pswd1ê³¼ pswd2ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° <span>ì‚¬ìš©ë¶ˆê°€</span>ì— disabled ì†ì„± ì¶”ê°€í•˜ëŠ”ê±´ ì–´ë–¤ê°€ìš”
                    $("#alertTxt").attr("disabled", "true");

                }
                else {
                    /* ì°¸ê³ ìš© */
                    // document.getElementById('check').innerHTML = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
                    // document.getElementById('check').style.color = 'rgb(255, 89, 89)';
                    // $("#check").css("font-size", "0.8rem");

                    /* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë¡œì§ - ì²´í¬ ë¶€íƒë“œë ¤ìš”! ì¼ë‹¨ ì„ì˜ë¡œ ë§Œë“¤ì–´ë†¨ìŠµë‹ˆë‹¤. */
                    alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    $("#btnJoin").attr("disabled", "true") // ê°€ì…í•˜ê¸° ë²„íŠ¼ì— disabled ì†ì„± ì¶”ê°€
                }
            }
        }

        /* !!!ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ alert */
        function checkData() {
            let form = document.getElementById('form_membership');
            if (form.id.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                    text: '20ê¸€ì ì´ë‚´',
                })
                return false;
            }

            if (form.pswd1.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                    text: '20ê¸€ì ì´ë‚´',
                })
                return false;
            } if (form.pswd2.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!',
                    text: '20ê¸€ì ì´ë‚´',
                })
                return false;
            } if (form.nickname.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                    text: '20ê¸€ì ì´ë‚´',
                })
                return false;
            }
            //ì´ë©”ì¼
            if (form.email.value != '' && !form.email.value.includes('@')) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.',
                    text: '100ê¸€ì ì´ë‚´',
                })
                return false;
            }
            //ì „í™”ë²ˆí˜¸, ì„±ë³„, ë‚˜ì´ ì²´í¬ ì¶”ê°€?

            // if (form.hintanswer.value == '') {
            //     Swal.fire({
            //         icon: 'warning',
            //         title: 'ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”',
            //         text: '50ê¸€ì ì´ë‚´',
            //     })
            //     return false;
            // }

            return true;
        }

        /* ê°€ì…í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ*/
        function membership() {
            let form = document.getElementById('form_membership');

            /// ê¸°ì¡´ ìœ íš¨ì„± ê²€ì‚¬
            // if (!form.checkValidity()) {
            //     form.reportValidity();
            //     return false;
            // }

            var flag = checkData(); // !!!ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€

            if (flag == true) { // ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼í•˜ë©´ Postìš”ì²­
                axios({
                    method: 'post',
                    url: 'http://localhost:8000/user/membership',
                    data: {
                        user_id: form.id.value,
                        pw: form.pswd1.value,
                        name: form.name.value,
                        nickName: form.nick.value,
                        tel: form.mobile.value,
                        email: form.email.value,
                        gender: form.gender.value,
                        age: form.age.value
                    }
                }).then((rep) => {
                    return rep.data;
                }).then((data) => {
                    console.log(data);
                    alert('íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤.');
                    document.location.href = 'http://localhost:8000/login';
                    //ê°€ì… í›„ ë°”ë¡œ ë¡œê·¸ì¸í•˜ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!
                })
            }
        }
    </script>
</head>

<body>
    <div id="membership">
        <div id="header">
            <a href="#" target="_blank">
                <img id="logo" src="../image/logo-5.png" alt="logo">
            </a>
        </div>

        <div id="container">
            <form id="form_membership">
                <div id="content">
                    <!-- ì•„ì´ë”” -->
                    <div>
                        <h3 class="join_title">
                            <label for="id">ì•„ì´ë””</label>
                        </h3>
                        <span class="box int_id">
                            <input type="text" name="id" id="id" class="int" maxlength="20" required>
                            <button type="button" onclick="idCheck()" class="checkBtn1">ì•„ì´ë”” ì¤‘ë³µ í™•ì¸</button>
                            <img id="id_check_sucess" style="display: none;">
                        </span>
                        <span class="error_next_box"></span>

                    </div>


                    <!-- ë¹„ë°€ë²ˆí˜¸ -->
                    <div>
                        <h3 class="join_title"><label for="pswd1">ë¹„ë°€ë²ˆí˜¸</label></h3>
                        <span class="box int_pass">
                            <input type="password" name="pswd1" id="pswd1" class="int" maxlength="20"
                                onchange="pwCheck()" required>
                            <span id="alertTxt">ì‚¬ìš©ë¶ˆê°€</span>
                            <img src="../image/icon/check-1.png" id="pswd1_img1" class="pswdImg">
                        </span>
                        <span class="error_next_box"></span>
                    </div>


                    <!-- ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸ -->
                    <div>
                        <h3 class="join_title"><label for="pswd2">ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label></h3>
                        <span class="box int_pass_check">
                            <input type="password" name="pswd2" id="pswd2" class="int" maxlength="20"
                                onchange="pwCheck()" required>
                            <img src="../image/icon/check-1-2.png" id="pswd2_img1" class="pswdImg">
                        </span>
                        <span class="error_next_box"></span>
                    </div>


                    <!-- ì´ë¦„ -->
                    <div>
                        <h3 class="join_title"><label for="name">ì´ë¦„</label></h3>
                        <span class="box int_name">
                            <input type="text" name="name" id="name" class="int" maxlength="20" required>
                        </span>
                        <span class="error_next_box"></span>
                    </div>

                    <!-- ë‹‰ë„¤ì„ -->
                    <div>
                        <h3 class="join_title">
                            <label for="nick">ë‹‰ë„¤ì„</label>
                        </h3>
                        <span class="box int_nick">
                            <input type="text" name="nick" id="nick" class="int" maxlength="20" required>
                            <button type="button" onclick="nickCheck()" class="checkBtn2">ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸</button>
                        </span>
                        <span class="error_next_box"></span>
                    </div>


                    <!-- ì „í™”ë²ˆí˜¸ -->
                    <div>
                        <h3 class="join_title"><label for="mobile">íœ´ëŒ€ì „í™”</label></h3>
                        <span class="box int_mobile">
                            <input type="tel" name="mobile" id="mobile" class="int" maxlength="16" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥"
                                required>
                        </span>
                        <span class="error_next_box"></span>
                    </div>


                    <!-- ì´ë©”ì¼ -->
                    <div>
                        <h3 class="join_title"><label for="email">ì´ë©”ì¼</label>
                        </h3>
                        <span class="box int_email">
                            <input type="text" name="email" id="email" class="int" maxlength="100" placeholder="ì„ íƒì…ë ¥"
                                required>
                        </span>
                        <span class="error_next_box">ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</span>
                    </div>


                    <!-- ì„±ë³„ -->
                    <div>
                        <h3 class="join_title"><label for="gender">ì„±ë³„</label></h3>
                        <span class="box gender_code">
                            <select name="gender" id="gender" class="sel" required>
                                <option>ì„±ë³„</option>
                                <option value="M">ë‚¨ì</option>
                                <option value="F">ì—¬ì</option>
                            </select>
                        </span>
                        <span class="error_next_box">í•„ìˆ˜ ì •ë³´ì…ë‹ˆë‹¤.</span>
                    </div>



                    <!-- ìƒë…„ì›”ì¼ -->
                    <div>
                        <h3 class="join_title"><label for="age">ë‚˜ì´</label></h3>
                        <span class="box int_age">
                            <input type="text" name="age" id="age" class="int" maxlength="5" required>
                        </span>
                        <span class="error_next_box"></span>
                    </div>


                    <!-- ê°€ì…í•˜ê¸° -->
                    <div class="btn_area">
                        <button type="button" id="btnJoin" onclick="membership();">
                            <span>ê°€ì…í•˜ê¸°</span>
                        </button>
                    </div>

                    <div>
                        <span class="copy">
                            <br>
                        </span>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script defer>
        $(document).ready(function () {
            $("input").focus(function () {
                $(this.parentNode).css('border', '1px solid #0359AE');
            })

            $("input").blur(function () {
                $(this.parentNode).css('border', '1px solid #dadada');
            })
        });

        $(document).ready(function () {
            $("select").focus(function () {
                $(this.parentNode).css('border', '1px solid #0359AE');
            })

            $("select").blur(function () {
                $(this.parentNode).css('border', '1px solid #dadada');
            })
        });
    </script>
</body>

</html>